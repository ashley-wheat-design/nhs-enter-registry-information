{# ------------------------------------------------------------
   Organisation label
------------------------------------------------------------ #}
{% set organisationHtml = "" %}
{% if currentOrganisation and currentOrganisation.name %}
  {% set organisationHtml %}
    {{ currentOrganisation.name | truncate(30) }}
  {% endset %}
{% endif %}

{# ------------------------------------------------------------
   Account items
------------------------------------------------------------ #}
{% set accountItems = [] %}

{% if currentUser %}
  {% set accountItems = accountItems.concat([{
    href: "/user-profile",
    text: (currentUser.firstName + " " + currentUser.lastName),
    icon: true
  }]) %}
{% endif %}

{% if currentOrganisation %}
  {% set accountItems = accountItems.concat([{
    html: organisationHtml
  }]) %}
{% endif %}

{% set accountItems = accountItems.concat([{
  href: "/sign-out",
  text: "Log out"
}]) %}

{# ------------------------------------------------------------
   Navigation items (journey-aware)
------------------------------------------------------------ #}
{% set navItemsWithAccountAndNav = [
  { text: "Home", href: "/dashboard", active: currentSection == "home" }
] %}

{% if data.journey == "singlePatientView" %}
  {% set navItemsWithAccountAndNav = navItemsWithAccountAndNav.concat([{
    text: "Patient search",
    href: "/record-procedure/patient/has-nhs-number",
    active: currentSection == "record-procedure"
  }]) %}
{% else %}
  {% set navItemsWithAccountAndNav = navItemsWithAccountAndNav.concat([{
    text: "Record a procedure",
    href: "/record-procedure/patient/has-nhs-number",
    active: currentSection == "record-procedure"
  }]) %}
{% endif %}

{% set navItemsWithAccountAndNav = navItemsWithAccountAndNav.concat([
  { text: "Bulk upload", href: "#", active: currentSection == "bulk-upload" },
  { text: "Reports", href: "#", active: currentSection == "reports" }
]) %}

{# ------------------------------------------------------------
   Navigation (no account variant)
------------------------------------------------------------ #}
{% set navItemsNavOnly = [
  { text: "Home", href: "#", active: currentSection == "home" },
  { text: "Record a procedure", href: "/record-procedure", active: currentSection == "record-procedure" },
  { text: "Find procedure", href: "#", active: currentSection == "find-treatment" },
  { text: "Bulk upload", href: "#", active: currentSection == "bulk-upload" },
  { text: "Reporting", href: "#", active: currentSection == "reporting" }
] %}

{# ------------------------------------------------------------
   Render header
------------------------------------------------------------ #}
{% if noNavigation != true and noAccount != true %}
  {{ header({
    service: {
      text: serviceName,
      href: "/"
    },
    account: {
      items: accountItems
    },
    navigation: {
      items: navItemsWithAccountAndNav
    }
  }) }}

{% elif noNavigation != true and noAccount == true %}
  {{ header({
    service: {
      text: serviceName,
      href: "/"
    },
    navigation: {
      items: navItemsNavOnly
    },
    account: {
      items: accountItems
    }
  }) }}

{% elif noNavigation == true and noAccount != true %}
  {{ header({
    service: {
      text: serviceName,
      href: "/"
    }
  }) }}

{% else %}
  {{ header({
    service: {
      text: serviceName,
      href: "/"
    }
  }) }}
{% endif %}
